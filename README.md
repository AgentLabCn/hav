# HAV (Hierarchical ABM Validation)

[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)
[![Python Version](https://img.shields.io/badge/Python-%3E%3D%203.10-blue)](https://www.python.org/downloads/)

## Summary

**HAV** is a powerful Python package tailored for Hierarchical Agent-Based Model (ABM) Validation. Agent-Based Models are widely used in various fields, such as social sciences, transportation, and economics, to simulate complex systems composed of autonomous agents. However, ensuring the accuracy and reliability of these simulations is crucial for making informed decisions based on the model outputs.
HAV addresses this challenge by providing a comprehensive framework to validate ABMs at three distinct levels: Agent, Model, and Output. At the Agent level, it focuses on validating the individual behavior and characteristics of agents within the model. The Model level assesses the overall structure and dynamics of the ABM, while the Output level evaluates the final results generated by the model against real - world data or predefined benchmarks.
This package integrates a diverse set of statistical methods and machine learning techniques. These tools are carefully selected to cover a wide range of validation requirements, from simple statistical tests to more advanced causal analysis and machine learning algorithms. By leveraging these methods, HAV helps users gain a deeper understanding of the strengths and weaknesses of their ABMs, enabling them to refine and improve the models for more accurate simulations.

### HAV Package
| File          | Description                                                                 |
|---------------|-----------------------------------------------------------------------------|
| `HAV.py`      | This is the core of the HAV package. It defines the **HAV** class, which encapsulates the entire validation workflow. The class provides a high - level interface for users to interact with the validation process, allowing them to specify the ABM model, parameters, and indicators in validation levels easily.     |
| `methods.py`  | Implements a variety of validation methods. These include the Mean Squared Error (MSE) test, which measures the average of the squares of the errors between the simulated and benchmark data; the Kolmogorov - Smirnov (KS) test is used to compare the distribution of two samples, ensuring that the simulated data follows a similar distribution as the benchmark; causal analysis methods are also available to understand the cause - effect relationships within the model, etc.   |
| `utils.py`    | Provides a set of utility functions that support the validation process. Data flattening functions are used to transform complex data structures into a more manageable format; bayesian tools are included for probabilistic inference, which can be useful for estimating model parameters and uncertainty quantification, etc.    |

### Test Scripts
| File               | Description                                                                 |
|--------------------|-----------------------------------------------------------------------------|
| `traffic_model.py`    | Defines a Traffic Flow Model as a case ABM model. This model simulates the movement of vehicles on a road network, taking into account factors such as road length, speed limit, number of vehicles, and driver behavior. It serves as a practical example for users to understand how to apply HAV to a real - world scenario. |
| `wealth_model.py`      | Defines a Wealth Transfer Model as a case ABM model. This model simulates the transfer of wealth between agents in an economic system, considering factors such as income, savings, and investment. It demonstrates the flexibility of HAV in validating different types of ABMs.        |
| `examples.py`      | Demonstrates how to perform multi - level validation on an ABM model. It provides step - by - step instructions and code snippets to guide users through the validation process, making it easier for them to get started with HAV.     |


## Installation

### 1. Install the base package
To install the HAV base package, you can use pip, the Python package installer. Simply run the following command in your terminal:

`pip install hav`

### 2. Install full dependencies (including optional analysis tools)
HAV has several optional dependencies that provide additional analysis capabilities. To install all the required dependencies, run the following command:

`pip install agentpy==0.1.5 numpy==1.25.2 pandas==1.5.3 pgmpy==0.1.25 scipy==1.14.0 statsmodels==0.14.0 catboost>=1.2.5 emcee>=3.1.6 SALib>=1.5.0`

It is recommended to create a virtual environment before installing the dependencies to avoid conflicts with other Python packages on your system. You can use venv or conda to create a virtual environment.


## Quick Start

### 1. Determine a ABM model to be validated (Taking `traffic_model.py` as an example)
First, you need to import the ABM model you want to validate. In this example, we use the TrafficModel from the `traffic_model.py` file:

`from traffic_model import TrafficModel`

### 2. Set paramenters required in Traffic Model
Next, you need to define the parameters for the TrafficModel. These parameters determine the initial conditions and behavior of the model. Here is an example of setting the parameters for the traffic model:

`    p = {    `
`        'road_length': 50000,  `
`        'speed_limit': 120 * 1000 / 60, `
`        'num_vehicles': 50,  `
`        'slow_down_prob': 0.15,  `
`        'acceleration': 2.5 * 1000 / 60,  `
`        'deceleration': 3.5 * 1000 / 60, `
`        'vehicle_lengths': [4, 5, 6, 12],  `
`        'vehicle_length_probs': [0.7, 0.15, 0.1, 0.05], `
`        'steps': 100,`
`        'observer_id': 10`
`    }`
### 3. Set Benchmark Data in validation
Benchmark data is used to compare with the simulated data during the validation process. You need to define the acceptable ranges for different metrics. Here is an example of setting the benchmark data for the traffic model:

`    Benchmark = {`
`        'Speed_range': (580, 300),`
`        'SIR_beta_range': (0.2, 1.0),`
`        'Pearson_corr_range': (0.8, 1.0)`
`    }`

### 4. Declare the parameters required in each validation level

You need to specify the simulated data and benchmark data for each validation level (Agent, Model, and Output). Here is an example:

`    A = {'S': ['Speed'], 'B': ['Speed_range']}`
`    M = {'S': ['Congestion'], 'B': ['SIR_beta_range']}`
`    O = {'S': ['num_vehicles', 'Congestion'], 'B': ['Pearson_corr_range']}`

Among them, `S` represents the indicator generated during the simulation process, and `B` represents it as the benchmark indicator.

### 5. Create HAV and do validation level by level`
`# 1 Create a HAV object`
`my_hav = HAV(TrafficModel, p, A, M, O)`
`# 2 Transmit validation methods that required in each level`
`my_hav.validate('Agent', test_SPEED_dist)`
`my_hav.validate('Model', test_CONGESTION_trans)`
`my_hav.validate('Output', test_CORR_FLOW_CONGESTION)`

Among them, `test_SPEED_dist`, `test_CONGESTION_trans` and `test_CORR_FLOW_CONGESTION` are validation methods that require user customization. You can implement these methods using the statistical and machine - learning techniques provided in the methods.py file or other external libraries.


## License
This project is licensed under the [Apache 2.0 License](https://opensource.org/licenses/Apache-2.0).